% Author: Victor Terron (c) 2013
% Email: `echo vt2rron1iaa32s | tr 132 @.e`
% License: GNU GPLv3

\documentclass[14pt]{beamer}

\usepackage[utf8]{inputenc}
\usepackage{listings}
\usepackage[T1]{fontenc}

% Reduce space between image and caption; also remove prefix 'Figure:'
% http://tex.stackexchange.com/a/94018
% http://tex.stackexchange.com/a/82462
\usepackage[font=small,skip=1pt,labelformat=empty]{caption}

% New line between paragraphs, no indentation
% http://tex.stackexchange.com/q/42
\usepackage[parfill]{parskip}

\usetheme{Copenhagen}
\useoutertheme{infolines}
\setbeamercovered{dynamic}
\setbeamertemplate{navigation symbols}{} % remove navigation symbols

\lstset{basicstyle=\ttfamily,language=python}

% Remove the space symbol for code inside the double quotation marks
% http://www.latex-community.org/viewtopic.php?f=4&t=248
\lstset{showstringspaces=false}

% Enable accents and ñ in our code listings
% http://stackoverflow.com/a/2782147/184363
\lstset{
  literate={á}{{\'a}}1
           {é}{{\'e}}1
           {í}{{\'i}}1
           {ó}{{\'o}}1
           {ú}{{\'u}}1
           {ñ}{{\~n}}1
           {¡}{{\textexclamdown}}1
}

\definecolor{red}{HTML}{F41B1B}
\definecolor{blue}{HTML}{2E3CEC}
\definecolor{green}{HTML}{3C8031}

% Beamer: footer with current slide number but not total slide number
% http://tex.stackexchange.com/a/32815
\makeatletter
\setbeamertemplate{footline}
{
  \leavevmode%
  \hbox{%
  \begin{beamercolorbox}[wd=.333333\paperwidth,ht=2.25ex,dp=1ex,center]{author in head/foot}%
    \usebeamerfont{author in head/foot}\insertshortauthor~~\beamer@ifempty{\insertshortinstitute}{}{(\insertshortinstitute)}
  \end{beamercolorbox}%
  \begin{beamercolorbox}[wd=.333333\paperwidth,ht=2.25ex,dp=1ex,center]{title in head/foot}%
    \usebeamerfont{title in head/foot}\insertshorttitle
  \end{beamercolorbox}%
  \begin{beamercolorbox}[wd=.333333\paperwidth,ht=2.25ex,dp=1ex,right]{date in head/foot}%
    \usebeamerfont{date in head/foot}\insertshortdate{}\hspace*{2em}
    \insertframenumber\hspace*{2ex}
  \end{beamercolorbox}}%
  \vskip0pt%
}
\makeatother

\title{["Python"] * 40}
\author{Víctor Terrón}
\date{23 de noviembre de 2013}
\institute{IAA-CSIC}

\begin{document}

\begin{frame}
  \titlepage

  \begin{figure}
    \vspace{-0.5cm}
    \includegraphics[width=2cm]{pics/mistery-box.jpg}
  \end{figure}

  \footnotesize
  \begin{center}
    Cuarenta características de Python que \structure{quizás} no conoces
  \end{center}

\end{frame}

\section{Introducción}

\begin{frame}{Unknown Unknowns}
  \small
  \begin{block}{}
    \centering
    ``There are things we know that we know. There are known
    unknowns. That is to say there are things that we now know we
    don't know. But there are also \structure{unknown unknowns}. There
    are things we do not know we don't know'' [Donald Rumsfeld, 2002]
  \end{block}

  \small
  \begin{itemize}
    \item En Python hay funcionalidades increíbles,
     \structure{imprescindibles una vez que las conoces}, que
     podríamos no echar en falta jamás porque ni siquiera sabíamos
     que existían.
    \item El propósito de esta charla es presentar una serie de
      aspectos interesantes de Python que en estos años he descubierto
      que mucha gente, incluso programadores veteranos, desconoce.
  \end{itemize}
\end{frame}

\begin{frame}{Unknown Unknowns}
  \begin{itemize}
    \item Algunas de las funcionalidades que vamos a discutir aquí son
      muy prácticas y otras curiosidades de indiscutiblemente escasa o
      nula utilidad en nuestro día a día. Pero todos ellos son
      conceptos \structure{sencillos de entender} y que merece la pena
      saber que están ahí, incluso si no los usamos... por ahora.
    \item Tenemos 1:15 minutos para cada uno de los puntos, así que
      muchos de ellos sólo vamos a poder \structure{verlos muy por
      encima}. Pero al menos habrán dejado de ser \emph{unknown
      unknowns}.
  \end{itemize}
\end{frame}

\begin{frame}{¡No os limitéis a escuchar!}
  \begin{center}
    No suele ser divertido escuchar a nadie hablar durante casi una
    hora. Participad, intervenid, criticad, opinad. ¡Si digo algo que
    no tiene ningún sentido, \structure{corregidme}!
  \end{center}

  \begin{block}{\centering El código fuente está disponible en:}
    \centering \url{http://github.com/vterron/PyConES-2013}
  \end{block}

  \begin{center}
    \small Erratas, correcciones, enlaces interesantes...\\ ¿enviará
    alguien algún pull request antes de que termine esta charla?
  \end{center}
\end{frame}

\begin{frame}{}
  \begin{alertblock}{}
    \centering \Large ¿Listos?
  \end{alertblock}

  \begin{figure}
    \centering
    \includegraphics[height=6cm]{pics/a-clockwork-orange.jpg}
  \end{figure}
\end{frame}

\section{Los diez primeros}

\input{01.tex}
\input{02.tex}
\input{03.tex}
\input{04.tex}
\input{05.tex}
\input{06.tex}
\input{07.tex}
\input{08.tex}
\input{09.tex}
\input{10.tex}

\section{Los diez siguientes}

\input{11.tex}
\input{12.tex}
\input{13.tex}
\input{14.tex}
\input{15.tex}
\input{16.tex}
\input{17.tex}
\input{18.tex}
\input{19.tex}
\input{20.tex}

\section{}

\begin{frame}{}
  \begin{block}{}
    \centering \Large Respira profundamente
  \end{block}

  \begin{figure}
    \centering
    \includegraphics[height=6cm]{pics/a-clockwork-orange-2.jpg}
  \end{figure}
\end{frame}

\section{Diez más}

\input{21.tex}
\input{22.tex}
\input{23.tex}
\input{24.tex}
\input{25.tex}
\input{26.tex}
\input{27.tex}
\input{28.tex}
\input{29.tex}
\input{30.tex}

\section{Recordatorio}
\begin{frame}[fragile]{A veces nos sentimos así}
  \begin{figure}
    \centering
    \includegraphics[height=6cm]{pics/un-palo.jpg}
  \end{figure}
\end{frame}

\section{Los últimos diez}

\input{31.tex}
\input{32.tex}
\input{33.tex}
\input{34.tex}

\begin{frame}[fragile]{35. functools.partial()}
  \small
  \begin{block}{}
    \centering
    En el módulo \structure{functools}, la función
    \structure{partial()} nos permite \emph{congelar} otra función,
    \structure{fijándole argumentos} de forma que podamos llamarla de
    forma más sencilla y corta.
  \end{block}

  \begin{exampleblock}{}
    \begin{lstlisting}
>>> import functools
>>> eleva_dos = functools.partial(pow, 2)
    \end{lstlisting}
  \end{exampleblock}

\begin{exampleblock}
  {Y ahora usándola:}
    \begin{lstlisting}
>>> eleva_dos(3)
8
>>> eleva_dos(10)
1024
    \end{lstlisting}
  \end{exampleblock}
\end{frame}

\begin{frame}[fragile]{35. functools.partial()}
  \small
  \begin{alertblock}{}
    \centering
    Es importante tener presente que los argumentos que nosotros le
    pasamos a la función \emph{congelada} se añaden
    \structure{después} de los que hemos definido en
    \structure{partial()}. Es necesario dar un rodeo si queremos crear
    funciones parciales que añadan los argumentos por el comienzo --
    por ejemplo, para devolver \structure{pow(x, 3)}.
  \end{alertblock}

  \begin{block}
    {\centering Python: Why is functools.partial necessary?}
    \centering \url{http://stackoverflow.com/a/3252425/184363}
  \end{block}

  \begin{block}
    {\centering implementing functools.partial that prepends additional arguments}
    \centering \url{http://stackoverflow.com/q/11831070/184363}
  \end{block}
\end{frame}

\begin{frame}[fragile]{36. Pasando funciones a iter()}
  \begin{block}{}
    \Large
    \centering iter(function, sentinel))
  \end{block}

  \small
  \begin{alertblock}{}
    \centering
    El uso más habitual de \structure{iter()} es pasarle un único
    argumento --- el objeto sobre el que queremos iterar. Pero también
    podemos pasarle una \structure{función}, que es ejecutada una y
    otra vez: en el momento en el que uno de los valores que devuelve
    sea igual a \structure{sentinel}, nos detenemos.
  \end{alertblock}
\end{frame}

\begin{frame}[fragile]{36. Pasando funciones a iter()}
  \small
  \begin{exampleblock}
    {Lee un fichero hasta la primera línea vacía:}
    \begin{lstlisting}
with open('currículum.tex') as fd:
    for linea in iter(fd.readline, '\n'):
        print linea
    \end{lstlisting}
  \end{exampleblock}
\end{frame}

\begin{frame}[fragile]{36. Pasando funciones a iter()}
  \small
  \begin{exampleblock}
    {Genera números aleatorios hasta llegar a cero:}
    \begin{lstlisting}
import random

def aleatorio():
    return random.randint(-10, 10)

for numero in iter(aleatorio, 0):
    print numero
    \end{lstlisting}
  \end{exampleblock}
\end{frame}

\begin{frame}[fragile]{37. Autocompletado en el intérprete}
  \small
  \begin{block}{}
    \centering
    En nuestro fichero \structure{.pythonrc}, estas líneas bastan para
    habilitar el \structure{autocompletado}, que se activa al pulsar
    tabulador, como estamos acostumbrados a hacer en la línea de
    comandos.
  \end{block}

  \begin{exampleblock}{}
    \begin{lstlisting}
import readline
import rlcompleter
readline.parse_and_bind("tab: complete")
    \end{lstlisting}
  \end{exampleblock}

  \footnotesize
  \begin{alertblock}{}
    \centering
    ¡La variable de entorno \structure{PYTHONSTARTUP} debe apuntar a este fichero!
  \end{alertblock}
\end{frame}

\begin{frame}[fragile]{38. Historia de comandos}
  \small
  \begin{block}{}
    \centering
    También podemos habilitar la historia de \structure{todo lo que
      hemos escrito} en el intérprete de Python, accesibles pulsando
    las \structure{teclas de navegación} vertical. Al igual que en una
    terminal cualquiera, la historia se guarda en un fichero, por lo
    que podemos reusar los comandos \structure{de una sesión a otra}.
  \end{block}

  \footnotesize
  \begin{exampleblock}{}
    \begin{lstlisting}
import atexit
import os.path
import readline

history_file = os.path.expanduser('~/.python_history')
if os.path.exists(history_file):
    readline.read_history_file(history_file)
func = readline.write_history_file
atexit.register(func, history_file)
    \end{lstlisting}
  \end{exampleblock}
\end{frame}

\begin{frame}[fragile]{39. Límite de memoria}
  \small
  \begin{block}{}
    \centering
    Antes hemos mencionado que crear una lista de tamaño excesivo
    podría usar \structure{toda la memoria} del ordenador, a veces con
    trágicas consecuencias. Usando esto podemos impedir que Python use
    más del 3/4 de la memoria total de nuestro equipo, abortando la
    ejecución \structure{si sobrepasamos este límite}.
  \end{block}

  \scriptsize
  \begin{exampleblock}{}
    \begin{lstlisting}
def get_ram_size():
    with open('/proc/meminfo', 'rt') as fd:
        regexp = "^MemTotal:\s*(\d+) kB$"
        match = re.match(regexp, fd.read(), re.MULTILINE)
        return int(match.group(1)) * 1024 # kB to bytes
MAX_RAM = get_ram_size() * 0.75
resource.setrlimit(resource.RLIMIT_AS,
                   (MAX_RAM, resource.RLIM_INFINITY))
    \end{lstlisting}
  \end{exampleblock}
\end{frame}

\begin{frame}[fragile]{39. Límite de memoria}
  \footnotesize
  \begin{exampleblock}
    {Esto es lo que ocurre entonces si abarcamos demasiado:}
    \begin{lstlisting}
>>> list(xrange(10e12))
Traceback (most recent call last):
  File ``<stdin>'', line 1, in <module>
MemoryError
    \end{lstlisting}
  \end{exampleblock}

  \small
  \begin{block}
    {\centering Por si alguien quiere reusar mi fichero .pythonrc}
    \centering \url{http://github.com/vterron/dotfiles}
  \end{block}
\end{frame}

\begin{frame}[fragile]{40. a, *b, c = range(5)}
  \begin{exampleblock}
    {\centering Un detalle precioso de Py3K}
    \small
    \begin{lstlisting}[escapechar=!]
>>> primero, !\color{blue}{*resto}! = range(5)
>>> primero
0
>>> resto
[1, 2, 3, 4]
>>> primero, !\color{blue}{*resto}!, ultimo = range(10)
>>> primero
0
>>> resto
[1, 2, 3, 4, 5, 6, 7, 8]
>>> ultimo
9
    \end{lstlisting}
  \end{exampleblock}
\end{frame}

\section{You Are Now a Ninja}
\begin{frame}[fragile]{Programadores Python Shaolín}
  \begin{figure}
    \centering
    \includegraphics[height=7cm]{pics/shaolin.jpg}
  \end{figure}
\end{frame}

\end{document}
